# Migration `20200404115123-vouchers-to-business-relation`

This migration has been generated by iqpc.mobile.native at 4/4/2020, 11:51:23 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Voucher" (
    "businessId" INTEGER   ,
    "description" TEXT NOT NULL  ,
    "expirationDate" TEXT   ,
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "imageUrl" TEXT NOT NULL  ,
    "name" TEXT NOT NULL  ,
    "price" REAL NOT NULL  ,
    "promotion" REAL   ,FOREIGN KEY ("businessId") REFERENCES "Voucher"("id") ON DELETE SET NULL ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Voucher" ("description", "expirationDate", "id", "imageUrl", "name", "price", "promotion") SELECT "description", "expirationDate", "id", "imageUrl", "name", "price", "promotion" FROM "quaint"."Voucher"

DROP TABLE "quaint"."Voucher";

ALTER TABLE "quaint"."new_Voucher" RENAME TO "Voucher";

CREATE UNIQUE INDEX "quaint"."Voucher.name" ON "Voucher"("name")

CREATE UNIQUE INDEX "quaint"."Voucher_businessId" ON "Voucher"("businessId")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Business" (
    "address" TEXT NOT NULL  ,
    "amount" REAL NOT NULL  ,
    "city" TEXT NOT NULL  ,
    "description" TEXT NOT NULL  ,
    "history" TEXT   ,
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "imageUrl" TEXT NOT NULL  ,
    "name" TEXT NOT NULL  ,
    "siteUrl" TEXT   ,
    "type" TEXT NOT NULL  
) 

INSERT INTO "quaint"."new_Business" ("address", "amount", "city", "description", "history", "id", "imageUrl", "name", "siteUrl") SELECT "address", "amount", "city", "description", "history", "id", "imageUrl", "name", "siteUrl" FROM "quaint"."Business"

DROP TABLE "quaint"."Business";

ALTER TABLE "quaint"."new_Business" RENAME TO "Business";

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200404113442-business-vouchers-tables..20200404115123-vouchers-to-business-relation
--- datamodel.dml
+++ datamodel.dml
@@ -3,19 +3,21 @@
 }
 datasource db {
   provider = "sqlite"
-  url = "***"
+  url = "file:./dev.db"
 }
 model Voucher {
   id Int @default(autoincrement()) @id
-  name String?
+  name String @unique
+  expirationDate String?
+  description String
+  imageUrl String
   price Float
   promotion Float?
-  expirationDate String
-  description String
-  imageUrl String
+  businessId Int?
+  company Voucher? @relation(fields: [businessId], references: [id])
 }
 model Business {
   id Int @default(autoincrement()) @id
@@ -26,5 +28,9 @@
   amount Float
   description String
   history String?
   imageUrl String
-}
+  type String
+  vouchers Voucher[]
+}
+
+
```


